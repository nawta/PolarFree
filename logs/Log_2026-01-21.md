# 開発ログ 2026-01-21

## PSD Stage 2 学習（続き）

### 学習状況

```
[開始時刻]: 2026-01-21 03:25
[バッチサイズ]: 8 (GPU 89GB使用)
[設定ファイル]: options/train/psd_stage2.yml
[総イテレーション]: 300,000 → 50,000で停止予定
```

### 学習進捗

| Iteration | Time | l_pix | l_pix_diff | l_vgg | l_phase |
|-----------|------|-------|------------|-------|---------|
| 5,000 | 04:43 | 8.73e-03 | 0.357 | 1.17e-03 | 0.213 |
| 10,000 | 06:00 | 6.67e-03 | 0.343 | 5.71e-04 | 0.167 |
| 15,000 | 07:17 | 9.00e-03 | 0.348 | 9.82e-04 | 0.150 |
| 20,000 | 08:35 | 6.22e-03 | 0.317 | 8.60e-04 | 0.228 |
| 25,000 | 09:52 | 7.32e-03 | 0.317 | 1.02e-03 | 0.247 |

### 50k停止設定

ユーザーリクエストにより、50,000イテレーションで学習を停止する。

- 監視スクリプト: `scripts/stop_at_50k.sh`
- 監視ログ: `logs/stop_monitor.log`
- 予定停止時刻: ~16:17 (約6.4時間後)
- チェックポイント: `experiments/psd_stage2/models/net_g_50000.pth`

### 50k到達・自動停止

```
[停止時刻]: 2026-01-21 18:56
[チェックポイント保存確認]: OK
[Validation PSNR]: 37.58 dB
```

---

## 評価結果

### Test Set (50 samples)
| Stage | Iteration | PSNR (dB) | SSIM |
|-------|-----------|-----------|------|
| Stage 1 | 100,000 | **34.85** | **0.9918** |
| Stage 2 | 50,000 | 34.45 | 0.9914 |

### 比較画像
`results/stage_comparison/` に保存

### 所見
- 両ステージとも鏡面反射除去に成功
- Test setではStage 1が若干優位（Stage 2は早期停止のため）
- 視覚的にはほぼ同等の品質

---

## 作成・更新したファイル

- `docs/PSD_training_results.md` - 学習結果のドキュメント
- `docs/datasets.md` - データセット情報
- `scripts/test_psd_checkpoint.py` - Stage 2対応追加

### 次のステップ

1. Stage 2を100k以上まで継続学習（オプション）
2. TRS特徴量を活用したモデル改良
3. 追加損失関数の適用

---

## oasis環境セットアップ

### 実施内容

1. docs/のパス情報を更新
   - サーバー別パス情報を追加（oasis: `/data/nishida/`, fleetwood: `/data2/`）
   - datasets.md, PSD_dataset_adaptation.md を更新

2. TODO.md作成

3. oasis用conda環境の構築
   - environment_oasis.ymlを作成
   - polarfree環境を構築完了（Python 3.10, PyTorch cu128, basicsr, mmcv等）
